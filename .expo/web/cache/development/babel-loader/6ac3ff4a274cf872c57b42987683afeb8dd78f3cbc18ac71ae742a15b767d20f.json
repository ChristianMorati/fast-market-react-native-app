{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport * as React from 'react';\nimport { NavigationContainer } from '@react-navigation/native';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { StatusBar as ExpoStatusBar } from 'expo-status-bar';\nimport Toast from 'react-native-toast-message';\nimport ProductProvider from \"./src/app/contexts/product-context\";\nimport AuthProvider, { useAuth } from \"./src/app/contexts/auth-context\";\nimport { StripeProvider } from '@stripe/stripe-react-native';\nimport PaymentProvider from \"./src/app/contexts/payment-context\";\nimport axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { BASE_URL_API, STRIPE_KEY } from \"./config\";\nimport RootNavigator from \"./src/app/router/root-navigator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nfunction App() {\n  var STYLES = ['default', 'dark-content', 'light-content'];\n  var _React$useState = React.useState(STYLES[2]),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    statusBarStyle = _React$useState2[0],\n    setStatusBarStyle = _React$useState2[1];\n  var authInterceptor = function authInterceptor() {\n    console.log('interceptor');\n    var refreshAttempts = 0;\n    axios.interceptors.response.use(function (response) {\n      return response;\n    }, function () {\n      var _ref = _asyncToGenerator(function* (error) {\n        try {\n          var _error$response;\n          var originalReq = error.config;\n          if (((_error$response = error.response) == null ? void 0 : _error$response.status) === 401 && originalReq && refreshAttempts === 0) {\n            refreshAttempts++;\n            var token = yield AsyncStorage.getItem('TOKEN');\n            if (!token) {\n              throw new Error('No token found');\n            }\n            var refreshResponse = yield axios.put(`${BASE_URL_API}/auth/refresh`, {\n              token: token\n            });\n            console.log(refreshResponse.data.access_token);\n            yield AsyncStorage.setItem('TOKEN', refreshResponse.data.access_token);\n            originalReq.headers['Authorization'] = `Bearer ${refreshResponse.data.access_token}`;\n            var retryResponse = yield axios(originalReq);\n            refreshAttempts = 0;\n            return retryResponse;\n          } else {\n            throw error;\n          }\n        } catch (err) {\n          console.error('Error in authInterceptor:', err);\n          refreshAttempts = 0;\n          throw err;\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  var auth = useAuth();\n  return _jsxs(_Fragment, {\n    children: [_jsxs(NavigationContainer, {\n      children: [_jsx(ExpoStatusBar, {\n        style: statusBarStyle === 'default' ? 'light' : 'light',\n        backgroundColor: \"black\"\n      }), _jsx(StripeProvider, {\n        publishableKey: STRIPE_KEY,\n        children: _jsx(PaymentProvider, {\n          children: _jsx(ProductProvider, {\n            children: _jsx(AuthProvider, {\n              children: _jsx(RootNavigator, {})\n            })\n          })\n        })\n      })]\n    }), _jsx(Toast, {})]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center'\n  },\n  buttonsContainer: {\n    padding: 0\n  },\n  textStyle: {\n    textAlign: 'center',\n    marginBottom: 8\n  }\n});\nexport default App;","map":{"version":3,"names":["React","NavigationContainer","StyleSheet","StatusBar","ExpoStatusBar","Toast","ProductProvider","AuthProvider","useAuth","StripeProvider","PaymentProvider","axios","AsyncStorage","BASE_URL_API","STRIPE_KEY","RootNavigator","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","App","STYLES","_React$useState","useState","_React$useState2","_slicedToArray","statusBarStyle","setStatusBarStyle","authInterceptor","console","log","refreshAttempts","interceptors","response","use","_ref","_asyncToGenerator","error","_error$response","originalReq","config","status","token","getItem","Error","refreshResponse","put","data","access_token","setItem","headers","retryResponse","err","_x","apply","arguments","auth","children","style","backgroundColor","publishableKey","styles","create","container","flex","justifyContent","buttonsContainer","padding","textStyle","textAlign","marginBottom"],"sources":["/home/dev/Documents/projects/react native/fast-market-react-native-app-main/App.tsx"],"sourcesContent":["import * as React from 'react';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { StyleSheet } from 'react-native';\nimport type { StatusBarStyle } from 'react-native';\nimport { StatusBar as ExpoStatusBar } from 'expo-status-bar';\nimport Toast from 'react-native-toast-message'\nimport ProductProvider from './src/app/contexts/product-context';\nimport AuthProvider, { useAuth } from './src/app/contexts/auth-context';\nimport { StripeProvider } from '@stripe/stripe-react-native';\nimport PaymentProvider from './src/app/contexts/payment-context';\nimport axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { BASE_URL_API, STRIPE_KEY } from './config';\nimport RootNavigator from './src/app/router/root-navigator';\n\nfunction App() {\n  const STYLES = ['default', 'dark-content', 'light-content'] as const;\n  const [statusBarStyle, setStatusBarStyle] = React.useState<StatusBarStyle>(STYLES[2]);\n\n  const authInterceptor = () => {\n    console.log('interceptor');\n\n    let refreshAttempts = 0;\n\n    axios.interceptors.response.use(\n      (response) => response,\n      async (error) => {\n        try {\n          const originalReq = error.config;\n\n          if (error.response?.status === 401 && originalReq && refreshAttempts === 0) {\n            refreshAttempts++;\n\n            const token = await AsyncStorage.getItem('TOKEN');\n\n            if (!token) {\n              // Handle the case when there is no token (e.g., user is not authenticated)\n              // You might want to redirect to login or take appropriate action\n              throw new Error('No token found');\n            }\n\n            const refreshResponse = await axios.put(`${BASE_URL_API}/auth/refresh`, { token });\n            console.log(refreshResponse.data.access_token);\n\n            // Atualize o token no AsyncStorage\n            await AsyncStorage.setItem('TOKEN', refreshResponse.data.access_token);\n\n            // Atualize o cabeçalho Authorization com o novo token\n            originalReq.headers['Authorization'] = `Bearer ${refreshResponse.data.access_token}`;\n\n            // Tente a solicitação original novamente com o novo token\n            const retryResponse = await axios(originalReq);\n\n            // Redefina as tentativas de atualização para 0 após uma tentativa bem-sucedida\n            refreshAttempts = 0;\n\n            return retryResponse;\n          } else {\n            throw error;\n          }\n        } catch (err) {\n          console.error('Error in authInterceptor:', err);\n          // console.error('Error response:', err.response);\n\n          // Se você quiser interromper a tentativa após um erro, defina refreshAttempts para 0\n          refreshAttempts = 0;\n\n          throw err;\n        }\n      }\n    );\n  };\n\n  // authInterceptor();\n\n  const auth = useAuth();\n\n  return (\n    <>\n      <NavigationContainer>\n        <ExpoStatusBar\n          style={statusBarStyle === 'default' ? 'light' : 'light'}\n          backgroundColor='black' />\n        <StripeProvider publishableKey={STRIPE_KEY}>\n          <PaymentProvider>\n            <ProductProvider>\n              <AuthProvider>\n                <RootNavigator />\n              </AuthProvider>\n            </ProductProvider>\n          </PaymentProvider>\n        </StripeProvider>\n      </NavigationContainer>\n      <Toast />\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    justifyContent: 'center',\n  },\n  buttonsContainer: {\n    padding: 0,\n  },\n  textStyle: {\n    textAlign: 'center',\n    marginBottom: 8,\n  },\n});\n\nexport default App;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}